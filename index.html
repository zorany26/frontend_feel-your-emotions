<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feel Your Emotions</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-" crossorigin="anonymous">
    <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>
    <header class="site-header bg-light border-bottom">
        <div class="container d-flex flex-wrap align-items-center justify-content-between py-3">
            <a href="#" class="d-flex align-items-center text-dark text-decoration-none logo">
                <img src="assets/images/logo-placeholder.png" alt="Feel Your Emotions" class="me-2" style="height:40px; width:auto; background:#eee; border-radius:6px;">
                <strong>Feel Your Emotions</strong>
            </a>

            <nav class="nav nav-pills">
                <a class="nav-link active" href="#" data-view="visualizations">Visualizaciones</a>
                <a class="nav-link" href="#" data-view="survey">Encuesta</a>
                <a class="nav-link" href="#" data-view="user">Registro</a>
            </nav>
        </div>
    </header>

    <main id="app" class="site-main">
        <div class="container py-4">
            <!-- Views will be loaded here -->
            <section id="view-root" class="view-root" aria-live="polite">
                <h2 class="text-center text-muted">Cargando...</h2>
            </section>
        </div>
    </main>

    <footer class="site-footer bg-white border-top">
        <div class="container py-3 text-center small text-muted">
            © <span id="year"></span> Feel Your Emotions — Proyecto de visualización y formularios
        </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        // small view loader to fetch HTML fragments from src/views
        const viewRoot = document.getElementById('view-root');
        const links = document.querySelectorAll('a[data-view]');
        const yearEl = document.getElementById('year');
        yearEl.textContent = new Date().getFullYear();

        async function loadView(name){
            const path = `src/views/${name === 'visualizations' ? 'visualizations' : 'forms'}/${name}.html`;
            try{
                const res = await fetch(path);
                if(!res.ok) throw new Error(res.status + ' ' + res.statusText);
                const html = await res.text();
                viewRoot.innerHTML = html;
                
                // Ejecutar scripts contenidos en la vista
                const scripts = viewRoot.getElementsByTagName('script');
                for(let script of scripts) {
                    const newScript = document.createElement('script');
                    Array.from(script.attributes).forEach(attr => {
                        newScript.setAttribute(attr.name, attr.value);
                    });
                    newScript.textContent = script.textContent;
                    script.parentNode.replaceChild(newScript, script);
                }

                // run simple init for charts placeholder
                if(name === 'visualizations'){
                    const canvases = viewRoot.querySelectorAll('canvas[data-chart]');
                    canvases.forEach(c => {
                        const ctx = c.getContext('2d');
                        // simple placeholder drawing
                        ctx.fillStyle = '#f3f3f3';
                        ctx.fillRect(0,0,c.width,c.height);
                        ctx.fillStyle = '#d9534f';
                        ctx.fillRect(10, c.height-30, 40, 30);
                        ctx.fillStyle = '#5bc0de';
                        ctx.fillRect(60, c.height-60, 40, 60);
                    })
                }
            }catch(err){
                viewRoot.innerHTML = `<div class="alert alert-danger" role="alert">No se pudo cargar la vista: ${err.message}</div>`;
            }
        }

        links.forEach(a => a.addEventListener('click', (e)=>{
            e.preventDefault();
            links.forEach(l => l.classList.remove('active'));
            e.currentTarget.classList.add('active');
            const name = e.currentTarget.getAttribute('data-view');
            loadView(name);
        }));

        // load default view
        loadView('visualizations');
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="" crossorigin="anonymous"></script>
</body>
</html>